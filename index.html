<script>
  const trades = [];
  const notifications = [];
  const vouches = [];

  function updateTradeFields() {
    const type = document.getElementById('tradeType').value;
    const container = document.getElementById('trade-details');
    let html = '';

    switch (type) {
      case 'pet-for-pet':
        html = `
          <label for="offerPet">Your Pet:</label>
          <select id="offerPet">
            <option value="Cat">Cat</option>
            <option value="Dog">Dog</option>
            <option value="Dragon">Dragon</option>
          </select>
          <label for="wantPet">Wanted Pet:</label>
          <select id="wantPet">
            <option value="Cat">Cat</option>
            <option value="Dog">Dog</option>
            <option value="Dragon">Dragon</option>
          </select>
        `;
        break;

      case 'pet-for-shekels':
        html = `
          <label for="offerPet">Your Pet:</label>
          <select id="offerPet">
            <option value="Cat">Cat</option>
            <option value="Dog">Dog</option>
            <option value="Dragon">Dragon</option>
          </select>
          <label for="wantAmount">Wanted Shekels:</label>
          <input type="text" id="wantAmount" placeholder="e.g., 500B, 1T">
        `;
        break;

      case 'shekels-for-pet':
        html = `
          <label for="offerAmount">Your Shekels:</label>
          <input type="text" id="offerAmount" placeholder="e.g., 1T">
          <label for="wantPet">Wanted Pet:</label>
          <select id="wantPet">
            <option value="Cat">Cat</option>
            <option value="Dog">Dog</option>
            <option value="Dragon">Dragon</option>
          </select>
        `;
        break;
    }

    container.innerHTML = html;
  }

  function postTrade() {
    const title = document.getElementById('title').value;
    const tradeType = document.getElementById('tradeType').value;

    let offer = '';
    let want = '';

    if (tradeType === 'pet-for-pet') {
      offer = document.getElementById('offerPet').value;
      want = document.getElementById('wantPet').value;
    } else if (tradeType === 'pet-for-shekels') {
      offer = document.getElementById('offerPet').value;
      want = document.getElementById('wantAmount').value;
    } else if (tradeType === 'shekels-for-pet') {
      offer = document.getElementById('offerAmount').value;
      want = document.getElementById('wantPet').value;
    }

    const trade = {
      title,
      type: tradeType,
      offer,
      want,
      user: "Anonymous",
      rating: 5
    };

    trades.push(trade);
    notifications.push(`New trade: ${title}`);
    updateFeed();
    updateNotifications();
  }

  function updateFeed() {
    const feed = document.getElementById('trade-feed');
    const searchTerm = document.getElementById('search').value.toLowerCase();
    const filterType = document.getElementById('filterType').value;
    feed.innerHTML = '';

    trades
      .filter(t => filterType === 'all' || t.type === filterType)
      .filter(t => t.title.toLowerCase().includes(searchTerm) || t.offer.toLowerCase().includes(searchTerm) || t.want.toLowerCase().includes(searchTerm))
      .forEach((t, index) => {
        const div = document.createElement('div');
        div.className = 'trade';
        div.innerHTML = `
          <strong>${t.title}</strong><br>
          <em>Type: ${t.type}</em>
          <p>Offer: ${t.offer} → Want: ${t.want}</p>
          <p>User: ${t.user} | ⭐ ${t.rating}</p>
          <button onclick="acceptTrade(${index})">Accept Trade</button>
        `;
        feed.appendChild(div);
      });
  }

  function acceptTrade(index) {
    const trade = trades[index];
    const message = `You accepted trade: ${trade.title}`;
    notifications.push(message);
    updateNotifications();
    addVoucher(trade);
  }

  function updateNotifications() {
    const container = document.getElementById('notifications');
    container.innerHTML = '';

    notifications.slice().reverse().forEach(msg => {
      const div = document.createElement('div');
      div.className = 'notification';
      div.textContent = msg;
      container.appendChild(div);
    });
  }

  function addVoucher(trade) {
    const container = document.getElementById('vouches');
    const div = document.createElement('div');
    div.className = 'voucher';
    div.innerHTML = `
      Trade completed with ${trade.user}. Leave a rating:
      <select onchange="rateTrade(this, '${trade.title}')">
        <option value="5">⭐⭐⭐⭐⭐</option>
        <option value="4">⭐⭐⭐⭐</option>
        <option value="3">⭐⭐⭐</option>
        <option value="2">⭐⭐</option>
        <option value="1">⭐</option>
      </select>
    `;
    container.appendChild(div);
  }

  function rateTrade(select, title) {
    const rating = parseInt(select.value);
    const trade = trades.find(t => t.title === title);
    if (trade) {
      trade.rating = rating;
      updateFeed();
    }
  }

  function sendFeedback() {
    alert('Thanks! Feedback form coming soon.');
  }

  // Initialize on load
  updateTradeFields();
</script>
